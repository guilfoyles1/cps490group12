doctype html
html
  head
    title Chat Room - #{room.name}
    link(rel="stylesheet", href="/css/styles.css")
    script(src="/socket.io/socket.io.js") // Import socket.io
  body
    h1 Chat Room: #{room.name}
    
    ul#message-list
      each message in messages
        li #{message.sender}: #{message.message}

    form#message-form
      input#message-input(type="text", placeholder="Enter your message", required)
      button(type="submit") Send

    // JavaScript for real-time chat functionality
    script.
      document.addEventListener('DOMContentLoaded', () => {
        const socket = io();

        // Set the username from the session
        socket.emit('set username', "#{username}");

        // Join the chat room
        const roomId = "#{room._id}";
        socket.emit('join room', roomId);

        // Listen for private messages
        socket.on('private message', ({ content, from }) => {
          const messageList = document.getElementById('message-list');
          const messageItem = document.createElement('li');
          messageItem.textContent = `${from}: ${content}`;
          messageList.appendChild(messageItem);
        });

        // Handle sending a message
        const messageForm = document.getElementById('message-form');
        messageForm.addEventListener('submit', (e) => {
          e.preventDefault();
          const messageInput = document.getElementById('message-input');
          const message = messageInput.value;

          socket.emit('private message', { content: message, room: roomId });
          messageInput.value = '';
        });
      });
